{% extends 'base.html' %}
{% load static %}

{% block title %}
{{ post.title }}
{% endblock %}
{% block css_files %}
<link rel="stylesheet" href="{% static 'blog/styles/post-detail.css' %}">
{% endblock %}
{% block content %}
<section id="summary">
    <h2>{{ post.title }}</h2>
    <div>
    {% for tag in post_tags%}
    <span class="tag"> {{ tag.caption}}</span>
    {%endfor%}
    </div>
    <article>
        <img src="{{ post.image.url}}"  alt="{{ post.title }}">
        <address>By<a href="mailto:{{post.author.email_address}}"> {{post.author|title}}</a></address>
            <div>
                Last updated on <time>{{ post.date|date:"d M Y" }}</time>
            </div>
    </article>
    
</section>
<main>
    <div class="post-content">
        {{ post.content|linebreaks }}
    </div>

    <!-- Comment Form -->
    <section class="comment-form">
        <form method="post" action="">
            {% csrf_token %}
            <h2>Leave a Comment</h2>
            {% if comment_form.errors %}
                <div class="form-errors">
                    <p>Please correct the errors below:</p>
                    <ul>
                        {% for field in comment_form %}
                            {% for error in field.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                        {% for error in comment_form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            {% for field in comment_form %}
                <div class="form-group">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text">{{ field.help_text }}</small>
                    {% endif %}
                </div>
            {% endfor %}
            <button class="btn-submit" type="submit">Submit Comment</button>
        </form>
    </section>

    <!-- Comments Section -->
    <section id="comments">
        <h2>Comments</h2>
        {% if post.comments.all %}
            <ul>
                {% for comment in post.comments.all %}
                    <li>
                        <article class="comment">
                            <header>
                                <h3>{{ comment.user_name }}</h3>
                                <time>{{ comment.date|date:"d M Y H:i" }}</time>
                            </header>
                            <p>{{ comment.text|linebreaks }}</p>
                        </article>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="no-comments">No comments yet. Be the first to comment!</p>
        {% endif %}
    </section>
</main>

{% endblock %}